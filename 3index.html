<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>FAQ</title>
<style>
  body { font-family: Arial, sans-serif; background: #f8f9fc; margin:0; padding:20px; }
  .search { width:100%; padding:10px; margin-bottom:15px; font-size:16px; border-radius:8px; border:1px solid #ccc; }
  .tabs { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:15px; }
  .tab { padding:8px 12px; cursor:pointer; border-radius:8px; background:#ececec; }
  .tab.active { background:#007bff; color:#fff; }
  .faq-item { background:#fff; padding:15px; border-radius:10px; margin-bottom:10px; border:1px solid #ddd; }
  .faq-question { font-weight:600; cursor:pointer; }
  .faq-answer { display:none; margin-top:8px; color:#444; }
</style>
</head>
<body>

<input id="search" class="search" type="text" placeholder="검색어를 입력하세요" />

<div id="tabs" class="tabs"></div>
<div id="faq-list"></div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/1216cKMHKiEbODsAzJeHoJ7Ermrea7_33wNbSEZnMQ1I/export?format=csv";

let faqData = [];
let activeCategory = "전체";

// csv 파싱 (쉼표 내 포함 값까지 처리)
function parseCSV(str) {
  const rows = [];
  let cur = "";
  let inQuotes = false;
  for (let i = 0; i < str.length; i++) {
    const char = str[i];
    const next = str[i+1];
    if (char === '"') {
      if (inQuotes && next === '"') {
        cur += '"';
        i++;
      } else {
        inQuotes = !inQuotes;
      }
    } else if (char === ',' && !inQuotes) {
      rows.push(cur.trim());
      cur = "";
    } else if ((char === "\n" || char === "\r") && !inQuotes) {
      if (cur !== "" || rows.length > 0) {
        rows.push(cur.trim());
        rows.length && (rows[rows.length-1] === "" ? null : rows);
        rows.push("\n");
        cur = "";
      }
    } else {
      cur += char;
    }
  }
  if(cur) rows.push(cur.trim());
  return rows;
}

async function loadCSV() {
  const res = await fetch(CSV_URL);
  const text = await res.text();
  const raw = text.split("\n").filter(r => r.trim() !== "");
  // 첫 줄 헤더 제거
  raw.shift();

  const parsedData = [];
  raw.forEach(line => {
    // 임시 쉼표 기반 파싱
    const row = parseCSV(line);
    if (row.length >= 3) {
      const category = row[0];
      const question = row[1];
      const answer = row.slice(2).join(", ");
      parsedData.push({ category, question, answer });
    }
  });

  faqData = parsedData;
  renderTabs();
  renderFAQ();
}

function renderTabs() {
  const container = document.getElementById("tabs");
  const cats = ["전체", ...new Set(faqData.map(f => f.category))];
  container.innerHTML = "";
  cats.forEach(cat => {
    const btn = document.createElement("div");
    btn.className = "tab" + (cat === activeCategory ? " active" : "");
    btn.textContent = cat;
    btn.onclick = () => {
      activeCategory = cat;
      renderFAQ();
      renderTabs();
    };
    container.appendChild(btn);
  });
}

function renderFAQ() {
  const list = document.getElementById("faq-list");
  const keyword = document.getElementById("search").value.toLowerCase();
  list.innerHTML = "";

  faqData
    .filter(item => (activeCategory === "전체" || item.category === activeCategory)
      && (item.question.toLowerCase().includes(keyword) || item.answer.toLowerCase().includes(keyword))
    )
    .forEach(item => {
      const div = document.createElement("div");
      div.className = "faq-item";
      div.innerHTML = `
        <div class="faq-question">${item.question}</div>
        <div class="faq-answer">${item.answer}</div>
      `;
      div.querySelector(".faq-question").onclick = () => {
        const ans = div.querySelector(".faq-answer");
        ans.style.display = ans.style.display === "block" ? "none" : "block";
      };
      list.appendChild(div);
    });
}

document.getElementById("search").addEventListener("input", renderFAQ);
loadCSV();
</script>

</body>
</html>
